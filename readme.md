
# bitmap-proxy

これは、汎用プロキシサーバーを画像サーバーでラップしたものです。

本サーバーは、ウェブ開発者が、外部サーバーと通信する必要のあるコードをブラウザ上で実行するために、ウェブサイトが指定するContent Security Policy(CSP)のconnect-srcの制約を、CSPを変更することなく回避しなければならない、という特殊な需要を想定して作成されました。

一般的に、img-srcはその他のCSP項目に比べて寛容に設定される傾向にあるため、本サーバーは、外部サーバーからの応答を画像にエンコードするプロキシエンドポイントを提供します。これにより、本プロキシのエンドポイントがimg-src制約によって許容されているウェブサイトに限り、ウェブ開発者は「見かけ上」CSP制約が緩和されたかのような振る舞いを実現できます。

本プロキシのエンドポイントURLは、HTMLImageElementのsrc属性に設定されることを想定しています。ウェブ開発者が本プロキシのURLを本来のリクエスト情報とともに正しく利用すると、ブラウザがそのHTMLImageElementをロードするために本プロキシと通信を開始します。本プロキシはブラウザからのリクエストを受信すると、本来のリクエスト情報を復元して外部サーバーにリクエストを送信します。その後、そのサーバーから受信した情報を画像データに埋め込んでリクエスト元のブラウザに返却します。これによりウェブ技術者は、外部サーバーに直接リクエストを送信するほかに、ブラウザの画像リクエストを介して外部サーバーから情報を得ることが可能になります。

# 使用方法

1. 本リポジトリをサーバー上にクローンします
1. `yarn` または `npm i` で `bitmap-proxy` をインストールします
1. `yarn start` または `npm run start` でサーバーを起動します



# 概要

通常、ウェブサイトのContent Security Policy(CSP)は、XSSをはじめとする脅威から利用者を保護するために、サービスの提供者によって設定されます。しかし、ユーザーによるコードの実行がサービスの機能の一部として提供されている場合、あるいは、ユーザーが各自で用意したコードを、サービス提供者の意図とは無関係に実行する場合では、ウェブサイトのCSPがユーザーの自由なスクリプティングを阻害することがあります。一方で、サービス提供者はユーザーを保護する社会的責任から、一度設定したCSPを緩和することはしばしば困難となります。本プロキシサーバーは、このような状況において、ユーザーの判断のみで利用できる、外部サーバーとの通信手段を提供します。

上記の用途のため、本サーバーはcors-anywhereを一部改変して利用しています。これにより、ウェブサイト上でCORSエラーを気にすることなく、画像情報のデコードが可能になります。

#　セキュリティ
